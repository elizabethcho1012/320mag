name: Scheduled Content Collection

# 매일 오전 9시(KST)에 자동 실행 (UTC 00:00 = KST 09:00)
# 또는 수동 실행 가능
on:
  schedule:
    # 매일 UTC 00:00 (KST 09:00)
    - cron: '0 0 * * *'

  # 수동 실행 허용
  workflow_dispatch:
    inputs:
      articles_per_category:
        description: '카테고리당 수집할 아티클 수'
        required: false
        default: '3'

jobs:
  collect-content:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Create .env file
        run: |
          echo "VITE_SUPABASE_PROJECT_ID=${{ secrets.VITE_SUPABASE_PROJECT_ID }}" >> .env
          echo "VITE_SUPABASE_PUBLISHABLE_KEY=${{ secrets.VITE_SUPABASE_PUBLISHABLE_KEY }}" >> .env
          echo "VITE_SUPABASE_URL=${{ secrets.VITE_SUPABASE_URL }}" >> .env
          echo "VITE_OPENAI_API_KEY=${{ secrets.VITE_OPENAI_API_KEY }}" >> .env

      - name: Run scheduled content collection
        run: npx tsx scripts/scheduled-collection.ts

      - name: Notify on failure
        if: failure()
        run: |
          echo "⚠️ Content collection failed!"
          exit 1
