# Third Twenty AI 에디팅 자동화 시스템

## 📊 시스템 개요

**목적**: 해외 트렌드 기사를 수집하여 Ageless Generation(AGene, 에이진)을 위한 완전히 새로운 콘텐츠로 자동 재창작

**최종 업데이트**: 2025-12-22 (기사 재점검 및 재분류 시스템 추가)

---

## 🎯 핵심 원칙

### 1. 사실 기반 저널리즘
- ✅ 원문의 사실 정보 정확히 유지 (인물명, 이벤트, 제품명, 날짜)
- ✅ 사실을 바탕으로 에디터만의 감각적인 글로 재구성
- ❌ 가상의 이야기나 인물 창작 금지
- ❌ 주제를 완전히 다른 것으로 변경 금지

### 2. 이미지-콘텐츠 매칭
- ✅ 원본 이미지 우선 사용 (RSS → OG Image → Unsplash)
- ✅ 이미지가 있으면 원본 주제 유지 필수
- ✅ 실존 인물 → 그 사람의 사진 필수

### 3. 법적 안전성
- ✅ Fair Use / 변형적 사용 (transformative use)
- ✅ 사실 정보만 추출, 표현은 완전히 다르게
- ✅ 원문 URL 출처 표기

---

## 💰 비용 구조

| 항목 | 모델 | 비용 |
|------|------|------|
| 카테고리 추론 | GPT-4 Turbo | $0.006/기사 |
| 콘텐츠 리라이팅 | Claude 3.5 Haiku | $0.015/기사 |
| **합계** | **하이브리드** | **₩27/기사** |

**월간 비용** (매일 3개 × 30일 = 90개):
- **₩2,430/월**
- GPT-4 단독 대비 82% 절감

---

## 📁 주요 문서

### 필수 문서
1. **[AI_EDITING_GUIDELINES.md](./AI_EDITING_GUIDELINES.md)** - 에디팅 자동화 시스템의 모든 기준
   - 법적 기준 (저작권, Fair Use)
   - 콘텐츠 변형 기준 (사실 추출 → 관점 전환 → 페르소나 적용)
   - 이미지-콘텐츠 매칭 기준
   - AI 프롬프트 구현 상태

2. **[HYBRID_IMPLEMENTATION.md](./HYBRID_IMPLEMENTATION.md)** - GPT-4 + Claude 3.5 Haiku 구현
   - 설치 방법
   - 비용 절감 효과
   - 사용 방법
   - 문제 해결

3. **[HAIKU_COST_ANALYSIS.md](./HAIKU_COST_ANALYSIS.md)** - Haiku 비용 분석
   - Sonnet vs Haiku 비교
   - 월간/연간 비용 시뮬레이션

### 참고 문서
4. **[IMAGE_MISMATCH_ANALYSIS.md](./IMAGE_MISMATCH_ANALYSIS.md)** - 이미지 매칭 문제 분석
5. **[API_COMPARISON.md](./API_COMPARISON.md)** - OpenAI vs Anthropic 비교
6. **[WEEKLY_ROTATION_PLAN.md](./WEEKLY_ROTATION_PLAN.md)** - 요일별 콘텐츠 순환 계획

---

## 🚀 빠른 시작

### 1. API 키 설정
`.env` 파일에 두 API 키 모두 필요:
```bash
# OpenAI (카테고리 추론)
OPENAI_API_KEY=sk-proj-...
VITE_OPENAI_API_KEY=sk-proj-...

# Anthropic (콘텐츠 리라이팅)
ANTHROPIC_API_KEY=sk-ant-api03-...
VITE_ANTHROPIC_API_KEY=sk-ant-api03-...
```

### 2. 테스트 실행
```bash
# 3개 카테고리 테스트 (패션, 뷰티, 운동)
npx tsx scripts/test-three-categories.ts
```

### 3. 매일 자동 수집
```bash
# 요일별 3개 자동 수집
npm run collect:daily

# Cron 설정 (매일 오전 9시)
0 9 * * * npm run collect:daily
```

---

## 📊 워크플로우

```
1. RSS 수집
   ↓
2. 카테고리 추론 (GPT-4) ← $0.006
   - 키워드 기반 빠른 추론
   - AI 기반 정확한 분류
   ↓
3. 이미지 중복 체크 (조기 차단)
   - 중복 이미지 감지 시 다음 기사로 자동 이동
   - AI 처리 비용 절감 (60초/기사 절약)
   ↓
4. 이미지 추출 (RSS/OG Image)
   ↓
5. 콘텐츠 리라이팅 (Claude 3.5 Haiku) ← $0.015
   - 사실 정보 유지
   - 이미지 매칭 제약
   - 페르소나 적용
   - 2000-2500자 에세이
   ↓
6. 중복 이미지 최종 체크
   ↓
7. Supabase 저장
   ↓
8. 목표 달성까지 반복 (3배 버퍼)
```

**총 비용**: $0.021 (약 ₩27/기사)

### 🔄 중복 이미지 처리 프로토콜 (2025-12-21 추가)

시스템은 중복 이미지를 자동으로 감지하고 다른 기사로 대체합니다:

- **3배 버퍼**: 4개 필요 시 12개 준비
- **자동 스킵**: 중복 감지 시 다음 기사 처리
- **목표 달성**: 성공 목표 달성까지 자동 반복
- **안전 장치**: 최대 50개까지만 시도

**예시**:
```
[시도 1/12] [성공 0/4] → 중복 감지, 스킵
[시도 2/12] [성공 0/4] → 중복 감지, 스킵
[시도 7/12] [성공 0/4] → 저장 성공! [성공 1/4]
...
[시도 10/12] [성공 3/4] → 저장 성공! [성공 4/4]
🎯 목표 달성! 4개 기사 수집 완료
```

### 🔍 기사 재점검 및 재분류 시스템 (2025-12-22 추가)

정기적으로 기존 기사를 재점검하고 올바른 카테고리로 재분류합니다:

**실행 방법**:
```bash
npx tsx scripts/audit-and-reclassify.ts
```

**처리 과정**:
1. **중복 기사 감지 및 삭제**
   - 제목 중복 체크
   - 이미지 중복 체크 (featured_image_url)
   - 중복 발견 시 첫 번째만 유지, 나머지 삭제

2. **카테고리 재검증**
   - Claude 3.5 Haiku로 모든 기사 분석
   - 키워드 추천 vs AI 분석 비교
   - AI가 콘텐츠 핵심 주제 파악하여 최종 결정

3. **재분류 실행**
   - 잘못된 카테고리 자동 수정
   - 업데이트 시간 기록
   - 상세한 로그 출력

**실행 결과 (2025-12-22 첫 실행)**:
```
📊 총 54개 기사 검증
   - 중복 기사: 0개
   - 재분류: 13개 (24%)
   - 유지: 41개 (76%)

📈 최종 카테고리 분포:
   섹슈얼리티: 13개
   푸드: 12개
   하우징: 7개
   여행: 6개
   뷰티: 5개
   라이프스타일: 4개
   패션: 4개
   심리: 3개
   운동: 0개 ⚠️
```

**주요 재분류 사례**:
- "아몬드 향..." → 패션에서 뷰티로 (향수)
- "색채의 동네..." → 패션에서 하우징으로 (건축/공간)
- "전쟁의 기억..." → 패션에서 여행으로 (여행지)
- "충동구매..." → 섹슈얼리티에서 심리로 (소비 심리)

**권장 주기**: 월 1회 또는 새 기사 대량 추가 후

---

## ✅ 품질 체크리스트

### 사실 정확성
- [ ] 인물명 정확히 유지
- [ ] 이벤트/제품명 정확
- [ ] 날짜/장소 정확

### 이미지 매칭
- [ ] 이미지 주제 = 기사 주제
- [ ] 실존 인물 사진 정확
- [ ] 제품 이미지 정확

### 법적 안전성
- [ ] 원문 번역 아님
- [ ] 원문 표현 사용 안 함
- [ ] 출처 URL 저장됨

### 독자 적합성
- [ ] 시니어 독자 관점
- [ ] 에디터 페르소나 명확
- [ ] 실천 가능한 조언 포함

---

## 🔧 구현 파일

- `src/services/aiRewriteService.ts` - Claude 3.5 Haiku 리라이팅
- `src/services/categoryInference.ts` - GPT-4 카테고리 추론
- `src/services/contentPipeline.ts` - 전체 파이프라인
- `scripts/daily-rotation.ts` - 매일 자동 수집
- `scripts/test-three-categories.ts` - 테스트 스크립트

---

## 📞 문제 해결

### Anthropic API 인증 오류
1. API 키 확인: https://console.anthropic.com/settings/keys
2. 크레딧 잔액 확인: https://console.anthropic.com/settings/billing
3. Sonnet 접근 불가 → Haiku 사용 (현재 구현)

### 이미지-내용 불일치
- 원본 주제가 유지되는지 확인
- AI 프롬프트 제약 확인
- 필요시 이미지 제거 (null)

---

**개발**: Claude Code
**상태**: ✅ 프로덕션 준비 완료
**비용**: ₩2,430/월 (90개 기사)
